var F=(e,i,m)=>new Promise((o,h)=>{var g=t=>{try{n(m.next(t))}catch(r){h(r)}},d=t=>{try{n(m.throw(t))}catch(r){h(r)}},n=t=>t.done?o(t.value):Promise.resolve(t.value).then(g,d);n((m=m.apply(e,i)).next())});import{B as I,a as k}from"./index.24728625.js";import{c as A,e as T}from"./index.e064266a.js";import{e as $,v as D}from"./index.85fdaa94.js";import{w as U}from"./pipeline.data.13f2061e.js";import{_ as z}from"./index.c0a3bc85.js";import{A as N,z as R,y as P,a0 as y,B as V,a1 as W,a5 as p,k as s,a4 as q}from"./vendor.52d192f7.js";import"./useWindowSizeFn.34f605a6.js";/* empty css               */const G=N({name:"RuleCopyModal",components:{BasicModal:I},emits:["success","register"],setup(e,{emit:i}){const m=R(),o=R({}),h=R(),g=R(),d=R();let n,t;const r=new Map;let u;const[S,{setModalProps:f,closeModal:M}]=k(l=>F(this,null,function*(){m.value.resetFields(),h.value=[],g.value=[],n=l.pipeline.sourceId,t=l.pipeline.endpointId,f({confirmLoading:!1,width:1200});const b=[];for(let a=0;a<l.currentRules.length;a++){let c=l.currentRules[a];r.set(a+"",c),b.push({label:"\u672C\u901A\u9053\uFF0C\u8868\uFF1A"+c.schema+"."+c.table,value:"curr-"+a})}const C=yield $(l.endpointType);for(let a=0;a<C.length;a++){let c=C[a];if(l.pipeline.id&&l.pipeline.id==c.pipelineId)continue;let _="other-"+a;r.set(_,c),b.push({label:"\u901A\u9053\uFF1A"+c.pipelineName+"\uFF0C\u8868\uFF1A"+c.schema+"."+c.table,value:_})}d.value=b;const v=[],w=yield A(n);for(let a=0;a<w.length;a++)v.push({label:w[a],value:w[a]});h.value=v})),O=P(()=>"\u62F7\u8D1D\u89C4\u5219");function B(){return F(this,null,function*(){alert(o.value.origin),u=r.get(o.value.origin)})}function L(){return F(this,null,function*(){o.value.table="";let l={schema:o.value.schema||""};yield j(l)})}function j(l){return F(this,null,function*(){const b=[],C=yield T(n,l);for(let v=0;v<C.length;v++)b.push({label:C[v],value:C[v]});g.value=b})}function E(){return F(this,null,function*(){try{let l=!1;if(yield m.value.validate().then(()=>{l=!0}),!l)return;u.key=o.value.schema+"."+o.value.table,u.schema=o.value.schema,u.table=o.value.table,u.sourceId=n,u.endpointId=t,u.isCopy=!0,yield D(u),i("success",u),M()}finally{f({confirmLoading:!1})}})}return{registerModal:S,getTitle:O,handleSubmit:E,formRef:m,formState:o,ruleCopyFormRules:U,schemaOptions:h,tableOptions:g,ruleOptions:d,onSchemaChange:L,onOriginChange:B}}});function H(e,i,m,o,h,g){const d=y("a-select"),n=y("a-form-item"),t=y("a-col"),r=y("a-row"),u=y("a-form"),S=y("BasicModal");return V(),W(S,q(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:p(()=>[s(u,{ref:"formRef",model:e.formState,rules:e.ruleCopyFormRules,"label-col":{style:{width:"120px"}},"wrapper-col":{span:16}},{default:p(()=>[s(r,null,{default:p(()=>[s(t,{span:24},{default:p(()=>[s(n,{label:"\u8981\u62F7\u8D1D\u7684\u89C4\u5219",name:"origin"},{default:p(()=>[s(d,{value:e.formState.origin,"onUpdate:value":i[0]||(i[0]=f=>e.formState.origin=f),options:e.ruleOptions,onChange:e.onOriginChange,placeholder:"\u8BF7\u9009\u62E9\u89C4\u5219"},null,8,["value","options","onChange"])]),_:1})]),_:1})]),_:1}),s(r,null,{default:p(()=>[s(t,{span:12},{default:p(()=>[s(n,{label:"\u76EE\u6807Schema",name:"schema"},{default:p(()=>[s(d,{value:e.formState.schema,"onUpdate:value":i[1]||(i[1]=f=>e.formState.schema=f),options:e.schemaOptions,onChange:e.onSchemaChange,placeholder:"\u8BF7\u9009\u62E9schema"},null,8,["value","options","onChange"])]),_:1})]),_:1}),s(t,{span:12},{default:p(()=>[s(n,{label:"\u76EE\u6807Table",name:"table"},{default:p(()=>[s(d,{value:e.formState.table,"onUpdate:value":i[2]||(i[2]=f=>e.formState.table=f),options:e.tableOptions,placeholder:"\u8BF7\u9009\u62E9table"},null,8,["value","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},16,["onRegister","title","onOk"])}var te=z(G,[["render",H]]);export{te as default};
