var se=Object.defineProperty,ie=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var ee=(u,o,c)=>o in u?se(u,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):u[o]=c,ue=(u,o)=>{for(var c in o||(o={}))de.call(o,c)&&ee(u,c,o[c]);if(x)for(var c of x(o))pe.call(o,c)&&ee(u,c,o[c]);return u},te=(u,o)=>ie(u,re(o));var R=(u,o,c)=>new Promise((I,L)=>{var D=r=>{try{m(c.next(r))}catch(d){L(d)}},F=r=>{try{m(c.throw(r))}catch(d){L(d)}},m=r=>r.done?I(r.value):Promise.resolve(r.value).then(D,F);m((c=c.apply(u,o)).next())});import{B as me,b as A,a as ce}from"./index.24728625.js";import{b as fe}from"./index.e064266a.js";import{j as ve,l as be}from"./endpoint.data.75dd7889.js";import{_ as Be,aJ as S,h as ke}from"./index.c0a3bc85.js";import Ee from"./RedisRuleModal.c702c525.js";import Me from"./EsRuleModal.223de680.js";import Re from"./MongodbRuleModal.fb84a55b.js";import Fe from"./MsgQueueRuleModal.7a80ecb0.js";import ge from"./HttpRuleModal.32b2a015.js";import ye from"./LuaScriptModal.865de4f1.js";import _e from"./RuleCopyModal.54d95afe.js";import{g as Ce,p as Ae,c as Se}from"./index.85fdaa94.js";import{A as he,b$ as Ie,bo as Le,c0 as De,z as g,u as $,y as Ue,a0 as i,B as Te,D as we,k as e,a5 as t,H as Y,a4 as Oe,aa as je,ad as y}from"./vendor.52d192f7.js";import"./useWindowSizeFn.34f605a6.js";/* empty css               */import"./pipeline.data.13f2061e.js";const We=he({name:"PipelineModal",components:{BasicModal:me,RedisRuleModal:Ee,EsRuleModal:Me,MongodbRuleModal:Re,MsgQueueRuleModal:Fe,HttpRuleModal:ge,LuaScriptModal:ye,RuleCopyModal:_e,EditOutlined:Ie,FormOutlined:Le,CopyOutlined:De},emits:["success","register"],setup(u,{emit:o}){const[c,{openModal:I}]=A(),[L,{openModal:D}]=A(),[F,{openModal:m}]=A(),[r,{openModal:d}]=A(),[O,{openModal:_}]=A(),[K,{openModal:U}]=A(),[h,{openModal:j}]=A(),{createErrorModal:b}=ke(),M=g(!0),T=g(),a=g({}),B=g(),W=g(),z=g(),f=g([]),C=new Map,N={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u7BA1\u9053\u540D\u79F0",trigger:"blur"},{max:20,message:"\u7BA1\u9053\u540D\u79F0\u7684\u6700\u5927\u957F\u5EA6\u4E3A20",trigger:"blur"}],sourceId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90",trigger:"blur"}],endpointId:[{required:!0,message:"\u8BF7\u9009\u62E9\u63A5\u6536\u7AEF\u70B9",trigger:"blur"}]},[H,{setModalProps:w,closeModal:P}]=ce(p=>R(this,null,function*(){if(T.value.resetFields(),w({confirmLoading:!1,width:1e3}),M.value=!!(p==null?void 0:p.isUpdate),$(M)){let s=yield Ce(p.id);a.value.id=s.id,a.value.name=s.name,a.value.sourceId=s.sourceId,a.value.endpointId=s.endpointId,a.value.createTime=s.createTime,a.value.updateTime=s.updateTime,a.value.status=s.status,a.value.streamBulkSize=s.streamBulkSize,a.value.streamFlushInterval=s.streamFlushInterval,a.value.batchCoroutines=s.batchCoroutines,a.value.batchBulkSize=s.batchBulkSize,a.value.alarmMailList=s.alarmMailList,a.value.alarmWebhook=s.alarmWebhook,a.value.alarmWebhookSecretKey=s.alarmWebhookSecretKey,a.value.alarmItemList=s.alarmItemList,s.alarmItemList?B.value=s.alarmItemList.split(","):B.value=[],f.value=s.rules}else a.value={id:void 0,name:"",sourceId:void 0,endpointId:void 0,sourceName:"",endpointName:"",createTime:void 0,updateTime:void 0,status:void 0,rules:void 0,streamBulkSize:100,streamFlushInterval:200,batchCoroutines:3,batchBulkSize:100,alarmMailList:"",alarmWebhook:"",alarmWebhookSecretKey:"",alarmItemList:""},B.value=["1","2","3","4"],f.value=[];const l=[],v=yield fe({enable:"true"});for(let s=0;s<v.length;s++){let E=v[s],G=`${E.name} [${E.host}:${E.port}]`,X=E.id;l.push({label:G,value:X})}W.value=l;const k=[],Z=yield ve({enable:"true"});for(let s=0;s<Z.length;s++){let E=Z[s];C.set(E.id,E.type);let G=be(E.type),X=`${E.name} [${G}  ${E.addresses}]`,ne=E.id;k.push({label:X,value:ne})}z.value=k})),Q=Ue(()=>$(M)?"\u7F16\u8F91\u7BA1\u9053":"\u65B0\u589E\u7BA1\u9053");function J(){return R(this,null,function*(){if(S(a.value.sourceId)){b({title:"\u9519\u8BEF\u63D0\u793A",content:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u6570\u636E\u6E90"});return}if(S(a.value.endpointId)){b({title:"\u9519\u8BEF\u63D0\u793A",content:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u63A5\u6536\u7AEF\u70B9"});return}switch(C.get(a.value.endpointId)){case 1:{I(!0,{pipeline:a.value,isUpdate:!1});break}case 2:{m(!0,{pipeline:a.value,isUpdate:!1});break}case 3:{D(!0,{pipeline:a.value,isUpdate:!1});break}case 4:{alert(4);break}case 5:{d(!0,{pipeline:a.value,endpointType:5,isUpdate:!1});break}case 6:{d(!0,{pipeline:a.value,endpointType:6,isUpdate:!1});break}case 7:{d(!0,{pipeline:a.value,endpointType:7,isUpdate:!1});break}case 8:{_(!0,{pipeline:a.value,isUpdate:!1});break}case 9:{alert(9);break}}})}function q(){return R(this,null,function*(){if(S(a.value.sourceId)){b({title:"\u9519\u8BEF\u63D0\u793A",content:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u6570\u636E\u6E90"});return}if(S(a.value.endpointId)){b({title:"\u9519\u8BEF\u63D0\u793A",content:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u63A5\u6536\u7AEF\u70B9"});return}U(!0,{pipeline:a.value,isUpdate:!1})})}function n(p){return R(this,null,function*(){let l;for(let k of f.value)if(k.key==p){l=JSON.parse(JSON.stringify(k));break}if((l==null?void 0:l.type)===1){U(!0,{current:l,pipeline:a.value,isUpdate:!0});return}switch(C.get(a.value.endpointId)){case 1:{I(!0,{pipeline:a.value,current:l,isUpdate:!0});break}case 2:{m(!0,{pipeline:a.value,current:l,isUpdate:!0});break}case 3:{D(!0,{pipeline:a.value,current:l,isUpdate:!0});break}case 4:{alert(4);break}case 5:{d(!0,{endpointType:5,pipeline:a.value,current:l,isUpdate:!0});break}case 6:{d(!0,{endpointType:6,pipeline:a.value,current:l,isUpdate:!0});break}case 7:{d(!0,{endpointType:7,pipeline:a.value,current:l,isUpdate:!0});break}case 8:{_(!0,{pipeline:a.value,current:l,isUpdate:!0});break}case 9:{alert(9);break}}})}function V(p){return R(this,null,function*(){let l=-1;for(let v=0;v<f.value.length;v++){let k=f.value[v];if(p===k.key){l=v;break}}l>-1&&f.value.splice(l,1)})}function ae(){return R(this,null,function*(){if(S(a.value.sourceId)){b({title:"\u9519\u8BEF\u63D0\u793A",content:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u6570\u636E\u6E90"});return}if(S(a.value.endpointId)){b({title:"\u9519\u8BEF\u63D0\u793A",content:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u63A5\u6536\u7AEF\u70B9"});return}let p=C.get(a.value.endpointId);j(!0,{pipeline:a.value,endpointType:p,currentRules:JSON.parse(JSON.stringify(f.value))})})}function le(p){return R(this,null,function*(){if(S(p.key)){let l=p.schema+"."+p.table;for(let v of f.value)if(v.key==l){b({title:"\u63D0\u793A",content:"\u5B58\u5728\u8868["+l+"]\u7684\u540C\u6B65\u89C4\u5219(\u811A\u672C)\uFF0C\u65E0\u9700\u91CD\u590D\u6DFB\u52A0\uFF01\uFF01\uFF01 "});return}p.key=l,f.value.push(p)}else{let l=-1;for(let v=0;v<f.value.length;v++){let k=f.value[v];if(p.key===k.key){l=v;break}}l>-1&&f.value.splice(l,1),f.value.push(p)}})}function oe(){return R(this,null,function*(){try{w({confirmLoading:!0});let p=!1;if(yield T.value.validate().then(()=>{p=!0}),!p)return;if(f.value.length===0){b({title:"\u9519\u8BEF\u63D0\u793A",content:"\u8BF7\u81F3\u5C11\u6DFB\u52A0\u4E00\u6761\u540C\u6B65\u89C4\u5219\u6216\u540C\u6B65\u811A\u672C"});return}let l=a.value;l.rules=f.value;let v=B.value.length;if((l.alarmMailList||l.alarmWebhook)&&v==0){b({title:"\u9519\u8BEF\u63D0\u793A",content:"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u79CD\u544A\u8B66\u7C7B\u578B"});return}if(v>0?l.alarmItemList=B.value.join(","):l.alarmItemList="",console.log(l),$(M))yield Ae(l);else{let k=C.get(l.endpointId);l.endpointType=k,l.flushBulkInterval==null&&(l.flushBulkInterval=200),l.flushBulkSize==null&&(l.flushBulkSize=100),yield Se(l)}P(),o("success",{isUpdate:$(M),values:te(ue({},l),{id:l.id})})}finally{w({confirmLoading:!1})}})}return{activeKey:g("1"),transformRuleItemList:f,sourceOptions:W,endpointOptions:z,registerModal:H,getTitle:Q,formRef:T,formState:a,alarmItemCheckboxList:B,rules:N,onAddRule:J,onAddScript:q,onAcceptRule:le,registerRedisRuleModal:c,registerEsRuleModal:L,registerMongodbRuleModal:F,registerMsgQueueRuleModal:r,registerHttpRuleModal:O,registerLuaScriptRuleModal:K,registerRuleCopyModal:h,handleSubmit:oe,onEditRule:n,onDelRule:V,onCopyRule:ae}}}),ze=y("\u5F02\u5E38\u4FE1\u606F"),$e=y("\u5168\u91CF\u540C\u6B65\u7ED3\u679C"),Ke=y("\u5B9E\u65F6\u540C\u6B65\u65E5\u62A5"),Ne=y("\u96C6\u7FA4\u8282\u70B9\u53D8\u52A8"),He=y("\u9AD8\u7EA7\u5C5E\u6027"),Pe=y(" \u6DFB\u52A0\u540C\u6B65\u89C4\u5219 "),Qe=y(" \u6DFB\u52A0\u540C\u6B65\u811A\u672C "),Je=y(" \u62F7\u8D1D "),qe=["onClick"],Ve=["onClick"];function Ge(u,o,c,I,L,D){const F=i("a-input"),m=i("a-form-item"),r=i("a-col"),d=i("a-row"),O=i("a-select"),_=i("a-checkbox"),K=i("a-checkbox-group"),U=i("a-divider"),h=i("a-input-number"),j=i("a-tab-pane"),b=i("EditOutlined"),M=i("a-button"),T=i("FormOutlined"),a=i("CopyOutlined"),B=i("a-table-column"),W=i("a-table"),z=i("a-tabs"),f=i("a-form"),C=i("BasicModal"),N=i("RedisRuleModal"),H=i("EsRuleModal"),w=i("MongodbRuleModal"),P=i("MsgQueueRuleModal"),Q=i("HttpRuleModal"),J=i("LuaScriptModal"),q=i("RuleCopyModal");return Te(),we(je,null,[e(C,Oe(u.$attrs,{onRegister:u.registerModal,canFullscreen:!1,defaultFullscreen:!0,title:u.getTitle,onOk:u.handleSubmit}),{default:t(()=>[e(f,{ref:"formRef",model:u.formState,rules:u.rules,"label-col":{style:{width:"180px"}},"wrapper-col":{span:16}},{default:t(()=>[e(z,{type:"card",activeKey:u.activeKey,"onUpdate:activeKey":o[11]||(o[11]=n=>u.activeKey=n)},{default:t(()=>[e(j,{key:"1",tab:"\u7BA1\u9053\u5C5E\u6027"},{default:t(()=>[e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,{label:"\u7BA1\u9053\u540D\u79F0",name:"name"},{default:t(()=>[e(F,{value:u.formState.name,"onUpdate:value":o[0]||(o[0]=n=>u.formState.name=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,{label:"\u6570\u636E\u6E90",name:"sourceId"},{default:t(()=>[e(O,{ref:"select",value:u.formState.sourceId,"onUpdate:value":o[1]||(o[1]=n=>u.formState.sourceId=n),options:u.sourceOptions,placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,{label:"\u63A5\u6536\u7AEF\u70B9",name:"endpointId"},{default:t(()=>[e(O,{ref:"select",value:u.formState.endpointId,"onUpdate:value":o[2]||(o[2]=n=>u.formState.endpointId=n),options:u.endpointOptions,placeholder:"\u8BF7\u9009\u62E9\u63A5\u6536\u7AEF\u70B9"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,{label:"\u544A\u8B66\u90AE\u7BB1\u5730\u5740",name:"alarmMailList"},{default:t(()=>[e(F,{placeholder:"\u8BF7\u8F93\u5165\u544A\u8B66\u90AE\u7BB1\u5730\u5740\uFF0C\u591A\u4E2A\u7528\u9017\u53F7\u5206\u5F00",value:u.formState.alarmMailList,"onUpdate:value":o[3]||(o[3]=n=>u.formState.alarmMailList=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,{label:"\u544A\u8B66\u9489\u9489Webhook\u5730\u5740",name:"alarmWebhook"},{default:t(()=>[e(F,{placeholder:"\u8BF7\u8F93\u5165\u544A\u8B66Webhook\u5730\u5740",value:u.formState.alarmWebhook,"onUpdate:value":o[4]||(o[4]=n=>u.formState.alarmWebhook=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,{label:"\u544A\u8B66\u9489\u9489Webhook\u79D8\u94A5",name:"alarmWebhookSecretKey"},{default:t(()=>[e(F,{we:"",placeholder:"\u8BF7\u8F93\u5165\u544A\u8B66Webhook\u79D8\u94A5",value:u.formState.alarmWebhookSecretKey,"onUpdate:value":o[5]||(o[5]=n=>u.formState.alarmWebhookSecretKey=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,{label:"\u544A\u8B66\u5185\u5BB9",name:"alarmItemCheckboxList"},{default:t(()=>[e(K,{value:u.alarmItemCheckboxList,"onUpdate:value":o[6]||(o[6]=n=>u.alarmItemCheckboxList=n)},{default:t(()=>[e(_,{value:"1",name:"alarmItemCheckboxList"},{default:t(()=>[ze]),_:1}),e(_,{value:"2",name:"alarmItemCheckboxList"},{default:t(()=>[$e]),_:1}),e(_,{value:"3",name:"alarmItemCheckboxList"},{default:t(()=>[Ke]),_:1}),e(_,{value:"4",name:"alarmItemCheckboxList"},{default:t(()=>[Ne]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(U,{orientation:"left"},{default:t(()=>[He]),_:1}),e(d,null,{default:t(()=>[e(r,{span:12},{default:t(()=>[e(m,{label:"\u5B9E\u65F6\u6570\u636E\u53D1\u9001\u9891\u7387(\u6BEB\u79D2)",name:"streamFlushInterval"},{default:t(()=>[e(h,{value:u.formState.streamFlushInterval,"onUpdate:value":o[7]||(o[7]=n=>u.formState.streamFlushInterval=n),min:200,max:36e5},null,8,["value"])]),_:1})]),_:1}),e(r,{span:10},{default:t(()=>[e(m,{label:"\u5B9E\u65F6\u6570\u636E\u6BCF\u6279\u6761\u6570",name:"streamBulkSize"},{default:t(()=>[e(h,{style:{width:"120px"},value:u.formState.streamBulkSize,"onUpdate:value":o[8]||(o[8]=n=>u.formState.streamBulkSize=n),min:100,max:1e4},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(r,{span:12},{default:t(()=>[e(m,{label:"\u5168\u91CF\u540C\u6B65\u5E76\u53D1\u6570",name:"batchCoroutines"},{default:t(()=>[e(h,{value:u.formState.batchCoroutines,"onUpdate:value":o[9]||(o[9]=n=>u.formState.batchCoroutines=n),min:1,max:100},null,8,["value"])]),_:1})]),_:1}),e(r,{span:10},{default:t(()=>[e(m,{label:"\u5168\u91CF\u540C\u6B65\u6BCF\u6279\u6761\u6570",name:"batchBulkSize"},{default:t(()=>[e(h,{style:{width:"120px"},value:u.formState.batchBulkSize,"onUpdate:value":o[10]||(o[10]=n=>u.formState.batchBulkSize=n),min:100,max:1e4},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(j,{key:"2",tab:"\u540C\u6B65\u89C4\u5219"},{default:t(()=>[e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,null,{default:t(()=>[e(M,{onClick:u.onAddRule},{default:t(()=>[e(b),Pe]),_:1},8,["onClick"]),e(M,{style:{"margin-left":"10px"},onClick:u.onAddScript},{default:t(()=>[e(T),Qe]),_:1},8,["onClick"]),e(M,{style:{"margin-left":"10px"},onClick:u.onCopyRule},{default:t(()=>[e(a),Je]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(r,{span:24},{default:t(()=>[e(m,null,{default:t(()=>[e(W,{"data-source":u.transformRuleItemList,rowKey:"key",pagination:!1,size:"small"},{default:t(()=>[e(B,{title:"Schema",key:"schema","data-index":"schema"}),e(B,{title:"Table",key:"table","data-index":"table"}),e(B,{title:"\u540C\u6B65\u6A21\u5F0F",key:"typeName","data-index":"typeName"}),e(B,{key:"action",title:"\u64CD\u4F5C"},{default:t(({record:n})=>[Y("span",null,[Y("a",{onClick:V=>u.onEditRule(n.key)},"\u7F16\u8F91 ",8,qe),e(U,{type:"vertical"}),Y("a",{onClick:V=>u.onDelRule(n.key)},"\u5220\u9664 ",8,Ve)])]),_:1})]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["activeKey"])]),_:1},8,["model","rules"])]),_:1},16,["onRegister","title","onOk"]),e(N,{onRegister:u.registerRedisRuleModal,onSuccess:u.onAcceptRule},null,8,["onRegister","onSuccess"]),e(H,{onRegister:u.registerEsRuleModal,onSuccess:u.onAcceptRule},null,8,["onRegister","onSuccess"]),e(w,{onRegister:u.registerMongodbRuleModal,onSuccess:u.onAcceptRule},null,8,["onRegister","onSuccess"]),e(P,{onRegister:u.registerMsgQueueRuleModal,onSuccess:u.onAcceptRule},null,8,["onRegister","onSuccess"]),e(Q,{onRegister:u.registerHttpRuleModal,onSuccess:u.onAcceptRule},null,8,["onRegister","onSuccess"]),e(J,{onRegister:u.registerLuaScriptRuleModal,onSuccess:u.onAcceptRule},null,8,["onRegister","onSuccess"]),e(q,{onRegister:u.registerRuleCopyModal,onSuccess:u.onAcceptRule},null,8,["onRegister","onSuccess"])],64)}var cu=Be(We,[["render",Ge]]);export{cu as default};
