var b=(e,u,i)=>new Promise((v,a)=>{var h=t=>{try{l(i.next(t))}catch(p){a(p)}},m=t=>{try{l(i.throw(t))}catch(p){a(p)}},l=t=>t.done?v(t.value):Promise.resolve(t.value).then(h,m);l((i=i.apply(e,u)).next())});import{B as L,a as B}from"./index.24728625.js";import{c as M,e as O}from"./index.e064266a.js";import{v as j}from"./index.85fdaa94.js";import{u as I,q as k,i as A,t as U,v as $}from"./pipeline.data.13f2061e.js";import{_ as D}from"./index.c0a3bc85.js";import{A as E,z as _,u as y,y as N,a0 as f,B as T,a1 as z,a5 as r,k as s,a4 as P}from"./vendor.52d192f7.js";import"./useWindowSizeFn.34f605a6.js";/* empty css               */const J=E({name:"LuaScriptModal",components:{BasicModal:L},emits:["success","register"],setup(e,{emit:u}){const i=_(!0),v=_(),a=_({}),h=_(),m=_();let l,t;const[p,{setModalProps:w,closeModal:g}]=B(o=>b(this,null,function*(){if(v.value.resetFields(),h.value=[],m.value=[],t=o.pipeline.endpointId,l=o.pipeline.sourceId,w({confirmLoading:!1,width:1200}),i.value=!!(o==null?void 0:o.isUpdate),y(i)){yield I(a.value,o.current),yield k(a.value,o.current);let n={schema:a.value.schema||""};yield F(n)}else yield A(a.value),yield U(a.value);const S=[],d=yield M(l);for(let n=0;n<d.length;n++)S.push({label:d[n],value:d[n]});h.value=S})),R=N(()=>y(i)?"\u7F16\u8F91\u811A\u672C":"\u65B0\u589E\u811A\u672C");function c(){return b(this,null,function*(){a.value.table="";let o={schema:a.value.schema||""};yield F(o)})}function F(o){return b(this,null,function*(){const S=[],d=yield O(l,o);for(let n=0;n<d.length;n++)S.push({label:d[n],value:d[n]});m.value=S})}function C(){return b(this,null,function*(){try{let o=!1;if(yield v.value.validate().then(()=>{o=!0}),!o)return;a.value.sourceId=l,a.value.endpointId=t,a.value.type=1,a.value.typeName="\u811A\u672C",yield j(a.value),u("success",JSON.parse(JSON.stringify(a.value))),g()}finally{w({confirmLoading:!1})}})}return{registerModal:p,getTitle:R,handleSubmit:C,formRef:v,formState:a,luaScriptFormRules:$,schemaOptions:h,tableOptions:m,onSchemaChange:c}}});function q(e,u,i,v,a,h){const m=f("a-select"),l=f("a-form-item"),t=f("a-col"),p=f("a-row"),w=f("a-textarea"),g=f("a-form"),R=f("BasicModal");return T(),z(R,P(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:r(()=>[s(g,{ref:"formRef",model:e.formState,rules:e.luaScriptFormRules,"label-col":{style:{width:"120px"}},"wrapper-col":{span:16}},{default:r(()=>[s(p,null,{default:r(()=>[s(t,{span:12},{default:r(()=>[s(l,{label:"schema",name:"schema"},{default:r(()=>[s(m,{value:e.formState.schema,"onUpdate:value":u[0]||(u[0]=c=>e.formState.schema=c),options:e.schemaOptions,onChange:e.onSchemaChange,placeholder:"\u8BF7\u9009\u62E9schema"},null,8,["value","options","onChange"])]),_:1})]),_:1}),s(t,{span:12},{default:r(()=>[s(l,{label:"table",name:"table"},{default:r(()=>[s(m,{value:e.formState.table,"onUpdate:value":u[1]||(u[1]=c=>e.formState.table=c),options:e.tableOptions,placeholder:"\u8BF7\u9009\u62E9table"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),s(p,null,{default:r(()=>[s(t,{span:24},{default:r(()=>[s(l,{label:"\u811A\u672C",name:"luaScript"},{default:r(()=>[s(w,{value:e.formState.luaScript,"onUpdate:value":u[2]||(u[2]=c=>e.formState.luaScript=c),"auto-size":{minRows:15,maxRows:1e3}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},16,["onRegister","title","onOk"])}var x=D(J,[["render",q]]);export{x as default};
