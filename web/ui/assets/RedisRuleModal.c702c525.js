var g=(u,t,h)=>new Promise((K,l)=>{var H=n=>{try{i(h.next(n))}catch(m){l(m)}},p=n=>{try{i(h.throw(n))}catch(m){l(m)}},i=n=>n.done?K(n.value):Promise.resolve(n.value).then(H,p);i((h=h.apply(u,t)).next())});import{B as $,a as q}from"./index.24728625.js";import{c as z,e as J,g as W}from"./index.e064266a.js";import{v as Q}from"./index.85fdaa94.js";import{u as X,a as Y,i as Z,b as x,r as ee}from"./pipeline.data.13f2061e.js";import{_ as ae}from"./index.c0a3bc85.js";import{A as ue,c1 as le,c2 as te,z as B,P as oe,u as V,y as ne,a0 as C,B as y,a1 as _,a5 as a,k as e,ac as b,D as G,ao as P,aa as L,a4 as se,ad as d}from"./vendor.52d192f7.js";import"./useWindowSizeFn.34f605a6.js";/* empty css               */const re=ue({name:"RedisRuleModal",components:{BasicModal:$,PlusOutlined:le,MinusCircleOutlined:te},emits:["success","register"],setup(u,{emit:t}){const h=B(!0),K=B(),l=B({}),H=B(),p=B(),i=B(),n=oe([{label:"Insert  Update  Delete",value:"0"},{label:"Insert  Update",value:"1"},{label:"Insert  Delete",value:"2"},{label:"Insert",value:"3"}]);let m,r,F;const[U,{setModalProps:k,closeModal:E}]=q(s=>g(this,null,function*(){if(K.value.resetFields(),H.value=[],p.value=[],i.value=[],r=s.pipeline.endpointId,m=s.pipeline.sourceId,k({confirmLoading:!1,width:1200}),h.value=!!(s==null?void 0:s.isUpdate),V(h)){yield X(l.value,s.current),yield Y(l.value,s.current);let S={schema:l.value.schema||""};yield M(S);let j={schema:l.value.schema||"",table:l.value.table||""};yield A(j)}else yield Z(l.value),yield x(l.value);const v=[],c=yield z(m);for(let S=0;S<c.length;S++)v.push({label:c[S],value:c[S]});H.value=v})),D=ne(()=>V(h)?"\u7F16\u8F91\u89C4\u5219":"\u65B0\u589E\u89C4\u5219");function R(){return g(this,null,function*(){var s;(s=l.value.columnMappingGroups)==null||s.push({column:"",mapping:""})})}function w(s){return g(this,null,function*(){var v;(v=l.value.columnMappingGroups)==null||v.splice(s,1)})}function O(){return g(this,null,function*(){var s;(s=l.value.additionalColumnValueMappingGroups)==null||s.push({column:"",value:""})})}function o(s){return g(this,null,function*(){var v;(v=l.value.additionalColumnValueMappingGroups)==null||v.splice(s,1)})}function f(){return g(this,null,function*(){l.value.table="",l.value.excludeColumnList=[],l.value.redisKeyColumn="",l.value.columnMappingGroups=[],i.value=[];let s={schema:l.value.schema||""};yield M(s)})}function M(s){return g(this,null,function*(){const v=[],c=yield J(m,s);for(let S=0;S<c.length;S++)v.push({label:c[S],value:c[S]});p.value=v})}function N(){return g(this,null,function*(){l.value.excludeColumnList=[],l.value.redisKeyColumn="",l.value.columnMappingGroups=[];let s={schema:l.value.schema||"",table:l.value.table||""};yield A(s);let v=l.value.redisStructure,c=l.value.redisKeyBuilder;v==="0"&&c==="0"&&(l.value.redisKeyColumn=F==null?void 0:F.primaryKeys[0])})}function A(s){return g(this,null,function*(){F=yield W(m,s);const v=[];for(let c=0;c<F.columns.length;c++){let S=F.columns[c].name;v.push({label:S,value:S})}i.value=v})}function T(){return g(this,null,function*(){let s=l.value.redisStructure;s==="0"&&(l.value.redisKeyBuilder="0",l.value.redisKeyColumn=F==null?void 0:F.primaryKeys[0],l.value.redisKeyFixValue="",l.value.redisHashFieldPrefix="",l.value.redisHashFieldColumn="",l.value.redisKeyFixValue="",l.value.redisSortedSetScoreColumn=""),s==="1"&&(l.value.redisKeyBuilder="",l.value.redisKeyColumn="",l.value.redisKeyPrefix="",l.value.redisSortedSetScoreColumn=""),(s==="2"||s==="3")&&(l.value.redisKeyBuilder="",l.value.redisKeyColumn="",l.value.redisKeyPrefix="",l.value.redisHashFieldPrefix="",l.value.redisHashFieldColumn="",l.value.redisSortedSetScoreColumn=""),s==="4"&&(l.value.redisKeyBuilder="",l.value.redisKeyColumn="",l.value.redisKeyPrefix="",l.value.redisHashFieldPrefix="",l.value.redisHashFieldColumn="")})}function I(){return g(this,null,function*(){try{let s=!1;if(yield K.value.validate().then(()=>{s=!0}),!s)return;l.value.sourceId=m,l.value.endpointId=r,l.value.endpointType=1,l.value.type=0,l.value.isCopy=!1,l.value.reserveCoveredData=!0,l.value.typeName="\u89C4\u5219",yield Q(l.value),t("success",JSON.parse(JSON.stringify(l.value))),E()}finally{k({confirmLoading:!1})}})}return{registerModal:U,getTitle:D,handleSubmit:I,formRef:K,formState:l,redisRuleFormRules:ee,schemaOptions:H,tableOptions:p,columnOptions:i,receiveTypeOptions:n,onSchemaChange:f,onTableChange:N,onRedisStructureChange:T,addColumnNameMapping:R,delColumnNameMapping:w,addAdditionalColumnValue:O,delAdditionalColumnValue:o}}}),de=d("JSON"),ie=d("\u8868\u8FBE\u5F0F"),me=d("\u5C0F\u5199"),pe=d("\u5927\u5199"),fe=d("\u9A7C\u5CF0"),ve=d(" \u5217\u540D\u6620\u5C04 "),ye=d(" \u9644\u52A0\u952E\u503C "),Se=d("yyyy-MM-dd"),ce=d("yyyy:MM:dd"),Ce=d("yyyy/MM/dd"),_e=d("yyyy MM dd"),Fe=d("MM/dd/yyyy"),Me=d("yyyyMMdd"),ge=d("yyyy-MM-dd HH:mm:ss.SSS"),be=d("yyyy-MM-dd HH:mm:ss"),he=d("yyyy-MM-dd HH:mm"),Ee=d("yyyy:MM:dd HH:mm:ss.SSS"),Ke=d("yyyy:MM:dd HH:mm:ss"),He=d("yyyy:MM:dd HH:mm"),Be=d("yyyy/MM/dd HH:mm:ss.SSS"),ke=d("yyyy/MM/dd HH:mm:ss"),Ue=d("yyyy/MM/dd HH:mm"),De=d("MM/dd/yyyy HH:mm:ss.SSS"),Re=d("MM/dd/yyyy HH:mm:ss"),we=d("MM/dd/yyyy HH:mm"),Oe=d("Redis\u5C5E\u6027"),Ae=d("String"),Ve=d("Hash"),Ge=d("List"),Pe=d("Set"),Le=d("Sorted Set"),Ne=d("\u5217\u503C"),Te=d("\u8868\u8FBE\u5F0F");function Ie(u,t,h,K,l,H){const p=C("a-select"),i=C("a-form-item"),n=C("a-col"),m=C("a-row"),r=C("a-select-option"),F=C("a-textarea"),U=C("PlusOutlined"),k=C("a-button"),E=C("a-input"),D=C("MinusCircleOutlined"),R=C("a-divider"),w=C("a-form"),O=C("BasicModal");return y(),_(O,se(u.$attrs,{onRegister:u.registerModal,title:u.getTitle,onOk:u.handleSubmit}),{default:a(()=>[e(w,{ref:"formRef",model:u.formState,rules:u.redisRuleFormRules,"label-col":{style:{width:"120px"}},"wrapper-col":{span:16}},{default:a(()=>[e(m,null,{default:a(()=>[e(n,{span:12},{default:a(()=>[e(i,{label:"schema",name:"schema"},{default:a(()=>[e(p,{value:u.formState.schema,"onUpdate:value":t[0]||(t[0]=o=>u.formState.schema=o),options:u.schemaOptions,onChange:u.onSchemaChange,placeholder:"\u8BF7\u9009\u62E9schema"},null,8,["value","options","onChange"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[e(i,{label:"table",name:"table"},{default:a(()=>[e(p,{value:u.formState.table,"onUpdate:value":t[1]||(t[1]=o=>u.formState.table=o),options:u.tableOptions,onChange:u.onTableChange,placeholder:"\u8BF7\u9009\u62E9table"},null,8,["value","options","onChange"])]),_:1})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{span:24},{default:a(()=>[e(i,{label:"\u6392\u9664\u7684\u5217",name:"excludeColumnList"},{default:a(()=>[e(p,{mode:"multiple",value:u.formState.excludeColumnList,"onUpdate:value":t[2]||(t[2]=o=>u.formState.excludeColumnList=o),options:u.columnOptions,placeholder:"\u8BF7\u9009\u62E9\u6392\u9664\u7684\u5217"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{span:12},{default:a(()=>[e(i,{label:"\u6570\u636E\u7F16\u7801",name:"dataEncoder"},{default:a(()=>[e(p,{value:u.formState.dataEncoder,"onUpdate:value":t[3]||(t[3]=o=>u.formState.dataEncoder=o),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u7F16\u7801"},{default:a(()=>[e(r,{value:"0"},{default:a(()=>[de]),_:1}),e(r,{value:"1"},{default:a(()=>[ie]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[u.formState.dataEncoder==="0"?(y(),_(i,{key:0,label:"\u5217\u540D\u8F6C\u6362",name:"columnNameFormatter"},{default:a(()=>[e(p,{value:u.formState.columnNameFormatter,"onUpdate:value":t[4]||(t[4]=o=>u.formState.columnNameFormatter=o),placeholder:"\u8BF7\u9009\u62E9\u5217\u540D\u8F6C\u6362"},{default:a(()=>[e(r,{value:"0"},{default:a(()=>[me]),_:1}),e(r,{value:"1"},{default:a(()=>[pe]),_:1}),e(r,{value:"2"},{default:a(()=>[fe]),_:1})]),_:1},8,["value"])]),_:1})):b("",!0)]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{span:24},{default:a(()=>[u.formState.dataEncoder==="1"?(y(),_(i,{key:0,label:"\u6570\u636E\u8868\u8FBE\u5F0F",name:"dataExpression"},{default:a(()=>[e(F,{value:u.formState.dataExpression,"onUpdate:value":t[5]||(t[5]=o=>u.formState.dataExpression=o),"auto-size":{minRows:2,maxRows:5}},null,8,["value"])]),_:1})):b("",!0)]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{span:24},{default:a(()=>[e(k,{type:"dashed",style:{"margin-left":"40px"},onClick:u.addColumnNameMapping},{default:a(()=>[e(U),ve]),_:1},8,["onClick"])]),_:1})]),_:1}),(y(!0),G(L,null,P(u.formState.columnMappingGroups,(o,f)=>(y(),_(m,{key:"row:"+f},{default:a(()=>[e(n,{span:10},{default:a(()=>[e(i,{label:"\u5217\u540D",name:["columnMappingGroups",f,"column"],rules:{required:!0,message:"\u5217\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[e(p,{value:u.formState.columnMappingGroups[f].column,"onUpdate:value":M=>u.formState.columnMappingGroups[f].column=M,options:u.columnOptions},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name"])]),_:2},1024),e(n,{span:10},{default:a(()=>[e(i,{label:"\u6620\u5C04\u540D",name:["columnMappingGroups",f,"mapping"],rules:{required:!0,message:"\u6620\u5C04\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[e(E,{value:u.formState.columnMappingGroups[f].mapping,"onUpdate:value":M=>u.formState.columnMappingGroups[f].mapping=M},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])]),_:2},1024),e(n,{span:4},{default:a(()=>[e(D,{class:"dynamic-delete-button",onClick:M=>u.delColumnNameMapping(f)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(m,null,{default:a(()=>[e(n,{span:24},{default:a(()=>[e(k,{type:"dashed",style:{"margin-left":"40px"},onClick:u.addAdditionalColumnValue},{default:a(()=>[e(U),ye]),_:1},8,["onClick"])]),_:1})]),_:1}),(y(!0),G(L,null,P(u.formState.additionalColumnValueMappingGroups,(o,f)=>(y(),_(m,{key:"row:"+f},{default:a(()=>[e(n,{span:10},{default:a(()=>[e(i,{label:"\u9644\u52A0\u5217",name:["additionalColumnValueMappingGroups",f,"column"],rules:{required:!0,message:"\u9644\u52A0\u5217\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[e(E,{value:u.formState.additionalColumnValueMappingGroups[f].column,"onUpdate:value":M=>u.formState.additionalColumnValueMappingGroups[f].column=M},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])]),_:2},1024),e(n,{span:10},{default:a(()=>[e(i,{label:"\u9644\u52A0\u503C",name:["additionalColumnValueMappingGroups",f,"value"],rules:{required:!0,message:"\u9644\u52A0\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[e(E,{value:u.formState.additionalColumnValueMappingGroups[f].value,"onUpdate:value":M=>u.formState.additionalColumnValueMappingGroups[f].value=M},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])]),_:2},1024),e(n,{span:4},{default:a(()=>[e(D,{class:"dynamic-delete-button",onClick:M=>u.delAdditionalColumnValue(f)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(m,null,{default:a(()=>[e(n,{span:12},{default:a(()=>[e(i,{label:"\u65E5\u671F\u683C\u5F0F",name:"dateFormatter"},{default:a(()=>[e(p,{value:u.formState.dateFormatter,"onUpdate:value":t[6]||(t[6]=o=>u.formState.dateFormatter=o)},{default:a(()=>[e(r,{value:"2006-01-02"},{default:a(()=>[Se]),_:1}),e(r,{value:"2006:01:02"},{default:a(()=>[ce]),_:1}),e(r,{value:"2006/01/02"},{default:a(()=>[Ce]),_:1}),e(r,{value:"2006 01 02"},{default:a(()=>[_e]),_:1}),e(r,{value:"01022006"},{default:a(()=>[Fe]),_:1}),e(r,{value:"20060102"},{default:a(()=>[Me]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[e(i,{label:"\u65E5\u671F\u65F6\u95F4\u683C\u5F0F",name:"datetimeFormatter"},{default:a(()=>[e(p,{value:u.formState.datetimeFormatter,"onUpdate:value":t[7]||(t[7]=o=>u.formState.datetimeFormatter=o)},{default:a(()=>[e(r,{value:"2006-01-02 15:04:05.999999999"},{default:a(()=>[ge]),_:1}),e(r,{value:"2006-01-02 15:04:05"},{default:a(()=>[be]),_:1}),e(r,{value:"2006-01-02 15:04"},{default:a(()=>[he]),_:1}),e(r,{value:"2006:01:02 15:04:05.999999999"},{default:a(()=>[Ee]),_:1}),e(r,{value:"2006:01:02 15:04:05"},{default:a(()=>[Ke]),_:1}),e(r,{value:"2006:01:02 15:04"},{default:a(()=>[He]),_:1}),e(r,{value:"2006/01/02 15:04:05.999999999"},{default:a(()=>[Be]),_:1}),e(r,{value:"2006/01/02 15:04:05"},{default:a(()=>[ke]),_:1}),e(r,{value:"2006/01/02 15:04"},{default:a(()=>[Ue]),_:1}),e(r,{value:"01/2006/02 15:04:05.999999999"},{default:a(()=>[De]),_:1}),e(r,{value:"01/2006/02 15:04:05"},{default:a(()=>[Re]),_:1}),e(r,{value:"01/2006/02 15:04"},{default:a(()=>[we]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{span:12},{default:a(()=>[e(i,{label:"\u76D1\u542C\u4E8B\u4EF6",name:"receiveType"},{default:a(()=>[e(p,{value:u.formState.receiveType,"onUpdate:value":t[8]||(t[8]=o=>u.formState.receiveType=o),options:u.receiveTypeOptions},null,8,["value","options"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[e(i,{label:"\u6392\u5E8F\u5217",name:"receiveTypes"},{default:a(()=>[e(p,{value:u.formState.orderColumn,"onUpdate:value":t[9]||(t[9]=o=>u.formState.orderColumn=o),options:u.columnOptions},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),e(R,{orientation:"left"},{default:a(()=>[Oe]),_:1}),e(m,null,{default:a(()=>[e(n,{span:12},{default:a(()=>[e(i,{label:"\u6570\u636E\u7C7B\u578B",name:"redisStructure"},{default:a(()=>[e(p,{value:u.formState.redisStructure,"onUpdate:value":t[10]||(t[10]=o=>u.formState.redisStructure=o),onChange:u.onRedisStructureChange},{default:a(()=>[e(r,{value:"0"},{default:a(()=>[Ae]),_:1}),e(r,{value:"1"},{default:a(()=>[Ve]),_:1}),e(r,{value:"2"},{default:a(()=>[Ge]),_:1}),e(r,{value:"3"},{default:a(()=>[Pe]),_:1}),e(r,{value:"4"},{default:a(()=>[Le]),_:1})]),_:1},8,["value","onChange"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[u.formState.redisStructure==="0"?(y(),_(i,{key:0,label:"key\u751F\u6210\u65B9\u5F0F",name:"redisKeyBuilder"},{default:a(()=>[e(p,{value:u.formState.redisKeyBuilder,"onUpdate:value":t[11]||(t[11]=o=>u.formState.redisKeyBuilder=o)},{default:a(()=>[e(r,{value:"0"},{default:a(()=>[Ne]),_:1}),e(r,{value:"1"},{default:a(()=>[Te]),_:1})]),_:1},8,["value"])]),_:1})):b("",!0),u.formState.redisStructure==="1"||u.formState.redisStructure==="2"||u.formState.redisStructure==="3"||u.formState.redisStructure==="4"?(y(),_(i,{key:1,label:"key\u540D\u79F0",name:"redisKeyFixValue"},{default:a(()=>[e(E,{value:u.formState.redisKeyFixValue,"onUpdate:value":t[12]||(t[12]=o=>u.formState.redisKeyFixValue=o)},null,8,["value"])]),_:1})):b("",!0)]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{span:12},{default:a(()=>[u.formState.redisStructure==="0"&&u.formState.redisKeyBuilder==="0"?(y(),_(i,{key:0,label:"key\u5217",name:"redisKeyColumn"},{default:a(()=>[e(p,{value:u.formState.redisKeyColumn,"onUpdate:value":t[13]||(t[13]=o=>u.formState.redisKeyColumn=o),options:u.columnOptions},null,8,["value","options"])]),_:1})):b("",!0),u.formState.redisStructure==="0"&&u.formState.redisKeyBuilder==="1"?(y(),_(i,{key:1,label:"key\u8868\u8FBE\u5F0F",name:"redisKeyExpression"},{default:a(()=>[e(F,{value:u.formState.redisKeyExpression,"onUpdate:value":t[14]||(t[14]=o=>u.formState.redisKeyExpression=o),"auto-size":{minRows:1,maxRows:5}},null,8,["value"])]),_:1})):b("",!0)]),_:1}),e(n,{span:12},{default:a(()=>[u.formState.redisStructure==="0"&&u.formState.redisKeyBuilder==="0"?(y(),_(i,{key:0,label:"key\u524D\u7F00",name:"redisKeyPrefix"},{default:a(()=>[e(E,{value:u.formState.redisKeyPrefix,"onUpdate:value":t[15]||(t[15]=o=>u.formState.redisKeyPrefix=o)},null,8,["value"])]),_:1})):b("",!0)]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{span:12},{default:a(()=>[u.formState.redisStructure==="1"?(y(),_(i,{key:0,label:"field\u524D\u7F00",name:"redisKeyPrefix"},{default:a(()=>[e(E,{value:u.formState.redisKeyPrefix,"onUpdate:value":t[16]||(t[16]=o=>u.formState.redisKeyPrefix=o)},null,8,["value"])]),_:1})):b("",!0)]),_:1}),e(n,{span:12},{default:a(()=>[u.formState.redisStructure==="1"?(y(),_(i,{key:0,label:"field\u5217",name:"redisHashFieldColumn"},{default:a(()=>[e(p,{value:u.formState.redisHashFieldColumn,"onUpdate:value":t[17]||(t[17]=o=>u.formState.redisHashFieldColumn=o),options:u.columnOptions},null,8,["value","options"])]),_:1})):b("",!0)]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{span:12},{default:a(()=>[u.formState.redisStructure==="4"?(y(),_(i,{key:0,label:"score\u5217",name:"redisSortedSetScoreColumn"},{default:a(()=>[e(p,{value:u.formState.redisSortedSetScoreColumn,"onUpdate:value":t[18]||(t[18]=o=>u.formState.redisSortedSetScoreColumn=o),options:u.columnOptions},null,8,["value","options"])]),_:1})):b("",!0)]),_:1}),e(n,{span:12})]),_:1})]),_:1},8,["model","rules"])]),_:1},16,["onRegister","title","onOk"])}var Ze=ae(re,[["render",Ie]]);export{Ze as default};
